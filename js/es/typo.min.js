!function(){"use strict";function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}let e=function(){function e(t,s,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.ERR_NOT_LOAD="Dictionary not loaded",this.ALPHABET="abcdefghijklmnopqrstuvwxyz",this.lDictionary="",this.rules={},this.dictionaryTable={},this.compoundRules=[],this.compoundRuleCodes={},this.replacementTable=new Array,this.memoized={},this.loaded=!1,this.options=o||{flags:{}},null!=o&&void 0!==o.flags?this.flags=o.flags:this.flags={};const n=t=>this._readFile(t,null),r=async(t,e,s)=>{const i=t=>{e=t,s&&r()},o=t=>{s=t,e&&r()},r=()=>{if(e&&s){this.rules=this._parseAFF(e),this.compoundRuleCodes={};for(const t of this.compoundRules)if("string"==typeof t)for(let e=0;e<t.length;e++)this.compoundRuleCodes[t.charAt(e)]=[];this.flags.ONLYINCOMPOUND&&(this.compoundRuleCodes[this.flags.ONLYINCOMPOUND]=[]),this.dictionaryTable=this._parseDIC(s);for(const t in this.compoundRuleCodes)Object.prototype.hasOwnProperty.call(this.compoundRuleCodes,t)&&0===this.compoundRuleCodes[t].length&&delete this.compoundRuleCodes[t];u=0;for(const t of this.compoundRules){let e="";if("string"==typeof t){for(const s of t)s in this.compoundRuleCodes?e+="("+this.compoundRuleCodes[s].join("|")+")":e+=s;this.compoundRules[u]=new RegExp(e,"i"),u++}}}},l=()=>{var t,e;return"function"==typeof(null===(t=window.chrome)||void 0===t||null===(e=t.runtime)||void 0===e?void 0:e.getURL)};let a,c,h,u;if(t)if(this.lDictionary=t,e&&s)r();else if("undefined"==typeof window||!0!==l()&&"function"==typeof(null===(f=window.browser)||void 0===f||null===(p=f.runtime)||void 0===p?void 0:p.getURL)!=!0)a=this.options.dictionaryPath?this.options.dictionaryPath:"undefined"!=typeof __dirname?__dirname+"/dictionaries":"./dictionaries",e||(c=n(a+"/"+t+"/"+t+".aff").then(t=>{i(t)})),s||(h=n(a+"/"+t+"/"+t+".dic").then(t=>{o(t)}));else{let r;a=this.options.dictionaryPath?this.options.dictionaryPath:"typo/dictionaries",r=!0===l()?window.chrome.runtime.getURL:window.browser.runtime.getURL,e||(c=n(r(a+"/"+t+"/"+t+".aff")).then(t=>{i(t)})),s||(h=n(r(a+"/"+t+"/"+t+".dic")).then(t=>{o(t)}))}var f,p;return new Promise((t,e)=>{Promise.all([h,c]).then(()=>{t(!0)}).catch(t=>{e(t)})})};this.readyPromise=new Promise((e,o)=>{r(t,s,i).then(()=>{e(this)}).catch(t=>{o(t)})}),this.options.loadedCallback&&this.ready.then()}var s,i,o;return s=e,(i=[{key:"load",value:function(t){for(const e in t)if(t.hasOwnProperty(e)&&Object(this).hasOwnProperty(e)){const s=t[e];Object.defineProperty(this,e.toString(),{value:s,writable:!0,enumerable:!0,configurable:!0})}return this}},{key:"check",value:function(t){if(!this.loaded)throw new Error(this.ERR_NOT_LOAD);if(0===t.length)return!1;const e=t.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(this.checkExact(e))return!0;if(e.toUpperCase()===e){const t=e[0]+e.substring(1).toLowerCase();if(this.hasFlag(t,"KEEPCASE"))return!1;if(this.checkExact(t))return!0}const s=e.toLowerCase();if(s!==e){if(this.hasFlag(s,"KEEPCASE"))return!1;if(this.checkExact(s))return!0}return!1}},{key:"checkExact",value:function(t){if(!this.loaded)throw new Error(this.ERR_NOT_LOAD);if(0===t.length)return!1;const e=this.dictionaryTable[t];if(void 0===e){if(this.flags.COMPOUNDMIN&&t.length>=this.flags.COMPOUNDMIN)for(const e of this.compoundRules)if(t.match(e))return!0}else{if(null===e)return!0;if("object"==typeof e)for(const s of e)if(null!==s&&!this.hasFlag(t,"ONLYINCOMPOUND",s))return!0}return!1}},{key:"hasFlag",value:function(t,e,s){if(!this.loaded)throw new Error(this.ERR_NOT_LOAD);if(e in this.flags){if(void 0===s){const e=this.dictionaryTable[t];s=null!=e?(t=>{const e=[];for(const s of t)for(const t of s)e.push(t);return e})(e):[]}if(s&&s.indexOf(this.flags[e])>=0)return!0}return!1}},{key:"suggest",value:function(t,e=5){if(!this.loaded)throw new Error(this.ERR_NOT_LOAD);if(this.memoized.hasOwnProperty(t)){const s=this.memoized[t].limit;if(e<=s||this.memoized[t].suggestions.length<s)return this.memoized[t].suggestions.slice(0,e)}if(this.check(t))return[];for(const e of this.replacementTable)if(-1!==t.indexOf(e[0])){const s=t.replace(e[0],e[1]);if(this.check(s))return[s]}const s=(t,e=!1)=>{const s={};let i,o,n,r,l;if("string"==typeof t){const e=t;(t={})[e]=1}for(const a in t)if(Object.prototype.hasOwnProperty.call(t,a))for(i=0,n=a.length+1;i<n;i++){const t=[a.substring(0,i),a.substring(i)];if(t[1]&&(l=t[0]+t[1].substring(1),e&&!this.check(l)||(l in s?s[l]+=1:s[l]=1)),t[1].length>1&&t[1][1]!==t[1][0]&&(l=t[0]+t[1][1]+t[1][0]+t[1].substring(2),e&&!this.check(l)||(l in s?s[l]+=1:s[l]=1)),t[1])for(o=0,r=this.ALPHABET.length;o<r;o++)this.ALPHABET[o]!==t[1].substring(0,1)&&(l=t[0]+this.ALPHABET[o]+t[1].substring(1),e&&!this.check(l)||(l in s?s[l]+=1:s[l]=1));if(t[1])for(o=0,r=this.ALPHABET.length;o<r;o++)l=t[0]+this.ALPHABET[o]+t[1],e&&!this.check(l)||(l in s?s[l]+=1:s[l]=1)}return s};return this.memoized[t]={suggestions:(t=>{const i=s(t),o=s(i,!0);for(const t in i)this.check(t)&&(t in o?o[t]+=i[t]:o[t]=i[t]);let n;const r=[];for(const t in o)o.hasOwnProperty(t)&&r.push([t,o[t]]);r.sort((t,e)=>{const s=t[1],i=e[1];return s<i?-1:s>i?1:e[0].toString().localeCompare(t[0].toString())}).reverse();const l=[];let a="lowercase";t.toUpperCase()===t?a="uppercase":t.substr(0,1).toUpperCase()+t.substr(1).toLowerCase()===t&&(a="capitalized");let c=e;for(n=0;n<Math.min(c,r.length);n++){let t=r[n][0].toString(),e=!1;"uppercase"===a?(t=t.toUpperCase(),e=!0):"capitalized"===a&&(t=t.substr(0,1).toUpperCase()+t.substr(1),e=!0),this.hasFlag(t,"NOSUGGEST")||-1!==l.indexOf(t)?c++:l.push(t),e&&(r[n][0]=t)}return l})(t),limit:e},this.memoized[t].suggestions}},{key:"_removeAffixComments",value:function(t){return t.replace(/^\s*#.*$/gm,"").replace(/^\s\s*/m,"").replace(/\s\s*$/m,"").replace(/\n{2,}/g,"\n").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}},{key:"_readFile",value:function(t,e){if(e=e||"utf8","undefined"!=typeof window){const s=new Headers;return s.set("Content-Type","text/plain; charset="+e),fetch(t,{method:"GET",headers:s}).then(t=>t.text())}return Promise.reject(new Error("An Error occured getting dictionary"))}},{key:"_parseAFF",value:function(t){const e={};let s,i,o,n,r,l=0,a=0,c=0;const h=(t=this._removeAffixComments(t)).split(/\r?\n/);for(a=h.length,r=0;r<a;r++){s=h[r];const t=s.split(/\s+/),a=t[0].toUpperCase();if("PFX"===a||"SFX"===a){const s=t[1],u=t[2].toUpperCase();o=parseInt(t[3],10);const f=[];if(!1===isNaN(o))for(l=r+1,c=r+1+o;l<c;l++){i=h[l],n=i.split(/\s+/);const t=n[2],e=n[3].split("/");let s=e[0];"0"===s&&(s="");const o=this.parseRuleCodes(e[1]),r=n[4],c={add:s};o.length>0&&(c.continuationClasses=o),"."!==r&&(c.match="SFX"===a?new RegExp(r+"$"):new RegExp("^"+r)),"0"!==t.toString()&&(c.remove="SFX"===a?new RegExp(t+"$"):new RegExp(t)),f.push(c)}e[s]={type:a,combineable:"Y"===u,entries:f},r+=o}else if("COMPOUNDRULE"===a){for(o=parseInt(t[1],10),l=r+1,c=r+1+o;l<c;l++)s=h[l],n=s.split(/\s+/),this.compoundRules.push(n[1]);r+=o}else"REP"===a?(n=s.split(/\s+/),3===n.length&&this.replacementTable.push([n[1],n[2]])):this.flags[a]=t[1]}return e}},{key:"_parseDIC",value:function(t){const e=(t=this._removeDicComments(t)).split(/\r?\n/),s={},i=(t,e)=>{if(s.hasOwnProperty(t)||(s[t]=null),e.length>0){let i=s[t];null==i&&(i=[],s[t]=i),i.push(e)}};for(let t=1;t<e.length;t++){const s=e[t];if(!s)continue;const o=s.split("/",2),n=o[0];if(o.length>1){const t=this.parseRuleCodes(o[1]);(!this.flags.NEEDAFFIX||this.flags.NEEDAFFIX&&-1===t.indexOf(this.flags.NEEDAFFIX))&&i(n,t);const e=t.length;for(let s=0;s<e;s++){const o=t[s],r=this.rules[o];if(r){const o=this._applyRule(n,r);for(const n of o)if(i(n,[]),r.combineable)for(let o=s+1;o<e;o++){const e=t[o],s=this.rules[e];if(s&&s.combineable&&r.type!==s.type){const t=this._applyRule(n,s);for(const e of t)i(e,[])}}}o in this.compoundRuleCodes&&this.compoundRuleCodes[o].push(n)}}else i(n.trim(),[])}return s}},{key:"_removeDicComments",value:function(t){return t.replace(/^\t.*$/gm,"")}},{key:"_applyRule",value:function(t,e){const s=e.entries;let i=[];for(const o of s)if(!o.match||t.match(o.match)){let s=t;o.remove&&(s=s.replace(o.remove,"")),"SFX"===e.type?s+=o.add:s=o.add+s,i.push(s),o.continuationClasses&&o.continuationClasses.map(t=>{const e=this.rules[t];e&&(i=i.concat(this._applyRule(s,e)))})}return i}},{key:"parseRuleCodes",value:function(t){if(!t||void 0===this.flags)return[];if(!this.flags.FLAG)return t.split("");if("long"===this.flags.FLAG){const e=[];for(let s=0;s<t.length;s+=2)e.push(t.substr(s,2));return e}return"num"===this.flags.FLAG?t.split(","):[]}},{key:"ready",get:function(){const t=(t,e)=>{this.options.loadedCallback&&("function"==typeof this.options.loadedCallback?this.options.loadedCallback(t,e):"object"==typeof this.options.loadedCallback&&this.options.loadedCallback.forEach(s=>{s(t,e)}))};return this.readyPromise.then(()=>(this.loaded=!0,t(null,this),this)).catch(e=>{throw t(e,this),e})}},{key:"dictionary",get:function(){return""===this.lDictionary?null:this.lDictionary}}])&&t(s.prototype,i),o&&t(s,o),e}();"undefined"!=typeof window&&void 0===window.Typo&&(window.Typo=e)}();